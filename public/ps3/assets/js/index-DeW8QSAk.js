(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const c of i)if(c.type==="childList")for(const P of c.addedNodes)P.tagName==="LINK"&&P.rel==="modulepreload"&&r(P)}).observe(document,{childList:!0,subtree:!0});function o(i){const c={};return i.integrity&&(c.integrity=i.integrity),i.referrerPolicy&&(c.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?c.credentials="include":i.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(i){if(i.ep)return;i.ep=!0;const c=o(i);fetch(i.href,c)}})();function y(t,e){PS.border(t,e,10),PS.borderColor(t,e,[65,65,65]),PS.scale(t,e,80),PS.bgColor(t,e,PS.COLOR_BLACK),PS.bgAlpha(t,e,255),PS.color(t,e,[130,130,130]),PS.data(t,e,{type:"wall",tag:"|"})}function f(t,e,o=!1){PS.border(t,e,2),PS.borderColor(t,e,PS.COLOR_BLACK),PS.scale(t,e,100),PS.bgColor(t,e,PS.COLOR_GRAY),PS.bgAlpha(t,e,255),PS.color(t,e,[200,200,200]);const r={type:"floor",tag:"_"};o&&(PS.glyph(t,e,"â˜…"),PS.glyphColor(t,e,PS.COLOR_YELLOW),r.hasKey=!0,r.onEnter=()=>{PS.glyph(t,e,"")}),PS.data(t,e,r)}function g(t,e){PS.border(t,e,4),PS.borderColor(t,e,PS.COLOR_BLACK),PS.color(t,e,[139,69,19]);const o={type:"door",tag:"D",skipRedraw:!0};o.onEnter=()=>{console.log(`Door on entered at (${t}, ${e})`),f(t,e)},PS.data(t,e,o)}function w(t,e){PS.border(t,e,4),PS.borderColor(t,e,PS.COLOR_BLACK),PS.color(t,e,PS.COLOR_GREEN),PS.data(t,e,{type:"final",tag:"+"})}const A={"|":y,_:f,K:(t,e)=>f(t,e,!0),D:g,"+":w},D=t=>{for(let e=0;e<t.length;e++)for(let o=0;o<t[e].length;o++){const r=t[e][o],i=A[r];i&&i(o,e)}},b=[["|","|","|","|","|","|","|","|"],["|","_","_","_","_","_","_","|"],["|","_","|","|","|","|","_","|"],["|","_","|","_","+","|","_","|"],["|","_","D","_","_","|","_","|"],["|","_","|","|","|","|","_","|"],["|","_","_","_","_","_","K","|"],["|","|","|","|","|","|","|","|"]];function k(){this.states=new Map,this.currentState=null,this.addState=function(t,e){if(this.states.has(t))throw new Error(`State "${t}" already exists.`);this.states.set(t,e)},this.setState=function(t){if(!this.states.has(t))throw new Error(`State "${t}" does not exist.`);console.log(`${this.currentState} --> ${t}
`),this.currentState=t},this.invoke=function(...t){if(!this.currentState)throw new Error("No current state set.");return this.states.get(this.currentState)(...t)},this.setAndInvoke=function(t,...e){return this.setState(t),this.invoke(...e)}}const h=["color","bgColor","bgAlpha","border","borderColor","scale","data"],S={UP:1006,RIGHT:1007,DOWN:1008,LEFT:1005};function K(t,e){return h.reduce((o,r)=>(o[r]=PS[r](t,e),o),{})}function R(t,e,o){for(const r of h)o.hasOwnProperty(r)&&PS[r](t,e,o[r])}function N(t){switch(t){case S.UP:return{x:0,y:-1};case S.RIGHT:return{x:1,y:0};case S.DOWN:return{x:0,y:1};case S.LEFT:return{x:-1,y:0};default:return null}}const a={IDLE:"idle",CHECK_MOVE:"checkMove",MOVING:"moving",HIT_WALL:"hitWall",KEY_PICKUP:"keyPickup",DOOR_INTERACTION:"doorInteraction",WIN:"win"},u={MOVE:"fx_bloop",HIT_WALL:"fx_bucket",KEY_PICKUP:"fx_coin1",DOOR_OPEN:"fx_squink",WIN:"fx_tada"};function v(t,e){const o=new k;let r=null,i=!1;this.name=t,this.x=1,this.y=1,this.startX=1,this.startY=1,this.keys=0;const c=(n,s)=>{r&&!r.skipRedraw&&R(this.x,this.y,r),this.x=n,this.y=s,r=K(n,s),PS.color(n,s,PS.COLOR_YELLOW),PS.scale(n,s,90),PS.data(n,s,{type:"player"})},P=n=>{if(!n)return;const{newX:s,newY:d}=n;PS.data(s,d)&&o.setAndInvoke(a.CHECK_MOVE,n)},O=n=>{const{newX:s,newY:d}=n,l=PS.data(s,d);if(!l||l.type==="wall")return o.setAndInvoke(a.HIT_WALL,n);if(l.type==="door")return o.setAndInvoke(a.DOOR_INTERACTION,n);if(l.type==="floor"&&l.hasKey)return o.setAndInvoke(a.KEY_PICKUP,n);if(l.type==="final")return o.setAndInvoke(a.WIN,n);o.setAndInvoke(a.MOVING,n)},I=({newX:n,newY:s})=>{const d=PS.data(n,s);this.keys+=1,PS.audioPlay(u.KEY_PICKUP),d.hasKey=!1,o.setAndInvoke(a.MOVING,{newX:n,newY:s})},p=n=>{PS.audioPlay(u.HIT_WALL),o.setAndInvoke(a.IDLE)},L=n=>this.keys>0?(PS.audioPlay(u.DOOR_OPEN),this.keys-=1,o.setAndInvoke(a.MOVING,n)):(PS.audioPlay(u.HIT_WALL),o.setAndInvoke(a.HIT_WALL,n)),C=n=>{i=!1,c(n.newX,n.newY),PS.audioPlay(u.WIN),PS.statusColor(PS.COLOR_GREEN),PS.statusText("You Win!")},E=({newX:n,newY:s})=>{const d=PS.data(n,s);d.onEnter&&d.onEnter(this),PS.audioPlay(u.MOVE),c(n,s),o.setAndInvoke(a.IDLE)};this.listenForInput=function(n){if(!i)return;const s=N(n.key);if(s){const d=this.x+s.x,l=this.y+s.y;o.invoke({newX:d,newY:l})}},this.init=function(n,s){if(o.addState(a.IDLE,P),o.addState(a.CHECK_MOVE,O),o.addState(a.KEY_PICKUP,I),o.addState(a.DOOR_INTERACTION,L),o.addState(a.HIT_WALL,p),o.addState(a.MOVING,E),o.addState(a.WIN,C),o.setState(a.IDLE),Object.keys(u).forEach(l=>{PS.audioLoad(u[l],{lock:!0})}),!PS.data(n,s))throw new Error(`Invalid start position (${n}, ${s}): out of bounds or map data missing.`);this.startX=n,this.startY=s,c(n,s),i=!0}}let _=new v("Link");PS.init=function(t,e){PS.gridSize(8,8),PS.gridColor(PS.COLOR_BLACK),PS.gridShadow(!0,PS.COLOR_WHITE),PS.statusText("Doors & Keys"),D(b),_.init(1,1)};PS.touch=function(t,e,o,r){};PS.release=function(t,e,o,r){};PS.enter=function(t,e,o,r){};PS.exit=function(t,e,o,r){};PS.exitGrid=function(t){};PS.keyDown=function(t,e,o,r){_.listenForInput({key:t,shift:e,ctrl:o,options:r})};PS.keyUp=function(t,e,o,r){};PS.input=function(t,e){};
//# sourceMappingURL=index-DeW8QSAk.js.map
